-- Question 1 : Écrire une requête qui affiche tous les couples (employee,manager) où manager est l’identifiant d’un chef direct ou indirect de l’employé d’identifiant employee

-- Solution :

    with recursive employ_manag(employee_id, manager_id) as (
      select employee_id, manager_id from employees where manager_id is not null
      union
      select e.employee_id, employ_manag.manager_id from employees as e, employ_manag where e.manager_id = employ_manag.employee_id
    )
    select * from employ_manag order by employee_id;
    
    
-- Question 2 : Ecrire une requête qui affiche tous les couples (employee, manager) où manager est le nom d’un chef direct ou indirect de l’employé de nom employee.

-- Solution :

WITH RECURSIVE employ_manag(employee_id, manager_id) AS
                   (
                       SELECT employee_id, manager_id
                       FROM employees as e
                       WHERE e.manager_id is not null
                       UNION
                       SELECT e.employee_id, em.manager_id
                       FROM employees as e,
                            employ_manag as em
                       WHERE e.manager_id = em.employee_id
                   )
select e.last_name, e2.last_name
from employees AS e
         JOIN employ_manag as emp
              on e.employee_id = emp.employee_id
         JOIN employees as e2 on e2.employee_id = emp.manager_id
order by e.last_name;
